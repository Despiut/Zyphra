<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Zyphra RPG</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.163.0/build/three.module.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.163.0/examples/jsm/controls/OrbitControls.js';

const worldSize = 100;
const blockSize = 1;

const scene = new THREE.Scene();
scene.background = new THREE.Color(0xff0000);

// Add light so blocks are visible
const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
scene.add(ambientLight);
const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
directionalLight.position.set(50, 100, 50);
scene.add(directionalLight);

// Camera
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 500);
camera.position.set(worldSize/2, 40, worldSize + 40);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Controls
const controls = new OrbitControls(camera, renderer.domElement);
controls.target.set(worldSize/2, 0, worldSize/2);
controls.update();

// Materials
const textures = {
    bedrock: new THREE.MeshStandardMaterial({ color: 0x111111 }),
    stone: new THREE.MeshStandardMaterial({ color: 0x888888 }),
    dirt: new THREE.MeshStandardMaterial({ color: 0x654321 }),
    grass: new THREE.MeshStandardMaterial({ color: 0x00ff00 })
};

// World array
const world = [];

// Generate world
for (let x=0; x<worldSize; x++){
    world[x] = [];
    for (let z=0; z<worldSize; z++){
        world[x][z] = [];
        const height = 4; 
        for (let y=0; y<height; y++){
            let material;
            if (y===0) material = textures.bedrock;
            else if (y===1) material = textures.stone;
            else if (y===2) material = textures.dirt;
            else material = textures.grass;

            const cube = new THREE.Mesh(
                new THREE.BoxGeometry(blockSize, blockSize, blockSize),
                material
            );
            cube.position.set(x, y, z);
            scene.add(cube);
            world[x][z][y] = { mesh: cube, type: y };
        }
    }
}

// Player
const playerGeometry = new THREE.BoxGeometry(0.8, 1.8, 0.8);
const playerMaterial = new THREE.MeshStandardMaterial({ color: 0x0000ff });
const player = new THREE.Mesh(playerGeometry, playerMaterial);
player.position.set(worldSize/2, 5, worldSize/2);
scene.add(player);

// Controls
const keys = {};
document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

function movePlayer(){
    const speed = 0.3;
    if(keys['w']) player.position.z -= speed;
    if(keys['s']) player.position.z += speed;
    if(keys['a']) player.position.x -= speed;
    if(keys['d']) player.position.x += speed;
}

// Render loop
function animate(){
    requestAnimationFrame(animate);
    movePlayer();
    controls.update();
    renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
